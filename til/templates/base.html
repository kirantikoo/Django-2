{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="csrf-token" content="{{ csrf_token }}">
    <title>{% block title %}Default Title{% endblock %}</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link rel="stylesheet" href="https://unpkg.com/boxicons@2.0.7/css/boxicons.min.css" />
  </head>
  <body class="bg-gray-100">
    <!-- Mobile nav toggle -->
    <div class="md:hidden flex items-center justify-between px-4 py-3 bg-white shadow">
      <h1 class="text-2xl font-bold text-indigo-600">TIL</h1>
      <button id="mobile-menu-button" class="text-gray-500 focus:outline-none">
        <i class='bx bx-menu text-3xl'></i>
      </button>
    </div>

    <!-- Sidebar for desktop and collapsible menu for mobile -->
    <div class="flex flex-col md:flex-row min-h-screen">
      <nav id="sidebar" class="bg-white md:w-56 w-full md:block hidden px-4 py-4 shadow-md">
        <ul class="space-y-4">
          <li>
            <a href="/" class="flex items-center text-gray-600 hover:text-indigo-600">
              <i class="bx bx-home text-xl"></i>
              <span class="ml-2">Home</span>
            </a>
          </li>
          <li>
            <a href="{% url 'profiles:update_profile' %}" class="flex items-center text-gray-600 hover:text-indigo-600">
            <i class="bx bx-user-circle text-xl"></i>
            <span class="ml-2">Update Profile</span>
            </a>
          </li>

          {% if request.user.is_authenticated %}
          <li>
            <a href="{% url 'feed:new_post' %}" class="flex items-center text-gray-600 hover:text-indigo-600 js-toggle-modal">
              <i class="bx bx-layer-plus text-xl"></i>
              <span class="ml-2">New Post</span>
            </a>
          </li>
          <li>
            <a href="{% url 'account_logout' %}" class="flex items-center text-gray-600 hover:text-indigo-600">
              <i class="bx bx-log-out text-xl"></i>
              <span class="ml-2">Logout</span>
            </a>
          </li>
          {% else %}
          <li>
            <a href="{% url 'account_login' %}" class="flex items-center text-gray-600 hover:text-indigo-600">
              <i class="bx bx-log-in text-xl"></i>
              <span class="ml-2">Login</span>
            </a>
          </li>
          {% endif %}
        </ul>
      </nav>

      <!-- Main content -->
      <main class="flex-1 p-4 md:p-16">
        {% block body %}
          {% block content %}{% endblock %}
        {% endblock %}
      </main>
    </div>

    {% if request.user.is_authenticated %}
    <!-- Modal for new post -->
    <div class="fixed inset-0 bg-black bg-opacity-60 hidden js-modal z-50 flex items-center justify-center">
      <div class="bg-white w-11/12 md:w-1/2 rounded-lg p-6">
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-lg font-semibold text-gray-700">New Post</h2>
          <button class="js-toggle-modal text-gray-600">
            <i class="bx bx-x text-2xl"></i>
          </button>
        </div>
        <textarea class="w-full border border-blue-400 rounded p-2 mb-4 js-post-text" rows="3" maxlength="240" placeholder="Enter your post" data-post-url="{% url 'feed:new_post' %}"></textarea>
        <div class="text-right">
          <button type="button" class="js-submit inline-flex items-center px-4 py-2 text-sm font-medium text-white bg-green-500 hover:bg-green-600 rounded">
            <span class="mr-2">Create Post</span>
            <i class="bx bx-send"></i>
          </button>
        </div>
      </div>
    </div>
    {% endif %}

    <!-- Hidden CSRF token form -->
    <form style="display: none;">{% csrf_token %}</form>

    <!-- JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="{% static 'js/main.js' %}"></script>
    <script>
      document.getElementById('mobile-menu-button').addEventListener('click', function() {
        const sidebar = document.getElementById('sidebar');
        sidebar.classList.toggle('hidden');
      });
    </script>
  </body>
</html>
